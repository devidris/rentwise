@using Microsoft.Extensions.Options;
@model AgentRegistrationModel
<form class="p-5" method="post" asp-action="RegisterAgent" asp-controller="Auth" enctype="multipart/form-data">
    <div class="d-none jsonstate">@ViewBag.JSONStates</div>
    <div asp-validation-summary="All" class="text-danger" role="alert"></div>
    <input  asp-for="@Model.Id" hidden/>
    <div class="form-floating mb-3">
        @if (Model.Id != null)
        {
            <input asp-for="@Model.FirstName" class="form-control" aria-required="true" readonly />
        } else
        {
            <input asp-for="@Model.FirstName" class="form-control" aria-required="true"  />
        }
        <label asp-for="@Model.FirstName" class="form-label">First name</label>
        <span asp-validation-for="@Model.FirstName" class="text-danger"></span>
    </div>
    <div class="form-floating mb-3">
        @if (Model.Id != null)
        {
            <input asp-for="@Model.LastName" class="form-control" aria-required="true" readonly />
        }
        else
        {
            <input asp-for="@Model.LastName" class="form-control" aria-required="true"  />
        }
        <label asp-for="@Model.LastName" class="form-label">Last name</label>
        <span asp-validation-for="@Model.LastName" class="text-danger"></span>
    </div>
    <div class="form-floating mb-3">
        <input asp-for="@Model.PhoneNumber" class="form-control" aria-required="true" />
        <label asp-for="@Model.PhoneNumber" class="form-label">Phone Number</label>
        <span asp-validation-for="@Model.PhoneNumber" class="text-danger"></span>
    </div>
    <div class="form-floating mb-3">
        <input asp-for="@Model.StoreName" class="form-control" aria-required="true" />
        <label asp-for="@Model.StoreName" class="form-label">Store name</label>
        <span asp-validation-for="@Model.StoreName" class="text-danger"></span>
    </div>
    <div class="form-floating mb-3 d-none">
        <input asp-for="@Model.Slug" class="form-control" aria-required="true" id="slugInput" value="@(Model.Id != null ? Model.Slug : ViewBag.UserId)" />
        <label asp-for="@Model.Slug" class="form-label">Slug</label>
        <span id="slugDisplay" class="mt-3"></span>
        <span asp-validation-for="@Model.Slug" class="text-danger"></span>
    </div>
    <div class="form-floating mb-3">
     
            <div class="form-floating mb-3">
                <select asp-for="@Model.Region" id="stateDropdown" class="form-control">
                    <option value="">Select a Region</option>
                    @foreach (State state in ViewBag.States)
                    {
                        <option value="@state.Name">@state.Name</option>
                    }
                </select>
                <label asp-for="@Model.City">Region</label>
            </div> 
        <div class="form-floating mb-3">
            <select  asp-for="@Model.City" id="cityDropdown" class="form-control" disabled>
                <option value="">Select a City</option>
            </select>
            <label for="cityDropdown" asp-for="@Model.City">City</label>
        </div>
        
        <input asp-for="@Model.StoreAddress" class="store-address" hidden />
        <input asp-for="@Model.Latitude" class="latitude" hidden />
        <input asp-for="@Model.Longitude" class="longitude" hidden />
        <input asp-for="@Model.StoreAddress" class="country"  hidden />
    </div>
    <div class="form-floating mb-3">
        <input asp-for="@Model.Logo" class="form-control" aria-required="true" type="file" accept="image/*" name="logo" />
        <label asp-for="@Model.Logo" class="form-label">Store Logo</label>
        <span asp-validation-for="@Model.Logo" class="text-danger"></span>
        @if (Model.Id != null)
        {
            string logo = $"~/images/agent/{Model.Id}/registration/Logo.Png";
            <img src="@Url.Content(logo)" alt="logo" width="100" height="100" />
        }
    </div>
    <div class="form-floating mb-3">
        <input asp-for="@Model.NationalCard" class="form-control" aria-required="true" type="file" accept="image/*" name="nationalCard" />
        <label asp-for="@Model.NationalCard" class="form-label">National Card</label>
        <span asp-validation-for="@Model.NationalCard" class="text-danger"></span>
        @if (Model.Id != null)
        {
            string NC = $"~/images/agent/{Model.Id}/registration/NationalCard.Png";
            <img src="@Url.Content(NC)" alt="logo" width="100" height="100" />
        }
    </div>
    @inject IOptions<RentWiseConfig> _config;

    @{
        string privacyLink = _config.Value.ClientWebsiteLink + "/Page/Policy";
        string tosLink = _config.Value.ClientWebsiteLink + "/Page/TOS";
    }
    <div class="checkbox mb-3">
        <label asp-for="@Model.Privacy" class="form-label">
            <input class="form-check-input" asp-for="@Model.Privacy" />
            <p class="d-inline-block">
                I have read and agree to the <a href="@tosLink" target="_blank">Terms and Conditions</a> and <a href="@privacyLink" target="_blank">Privacy Policy</a>
            </p>
        </label>
        <span asp-validation-for="@Model.Privacy" class="text-danger"></span>
    </div>
   @if(Model.Id != null)
    {
        <button type="submit" class="btn btn-primary">Update</button>
    }
    else
    {
        <button type="submit" class="btn btn-primary">Submit for verification</button>
    }
</form>
@section Scripts {

    <partial name="_ValidationScriptsPartial" />
}
   
   
    <script>
        function initMap() {
            document.addEventListener('DOMContentLoaded', function () {
                const slugInput = document.getElementById('slugInput');
                const slugDisplay = document.getElementById('slugDisplay');
                slugDisplay.textContent = "https://www.rentwise.com/store/" + slugInput.value;

                slugInput.addEventListener('input', function () {
                    slugDisplay.textContent = "https://www.rentwise.com/store/" + slugInput.value;
                });
            });
        }
        initMap();
    </script>
    <script>
    $(document).ready(function() {
        const JSONstates = JSON.parse($('.jsonstate').text());
        $(".jsonstate").remove();
   
    // Set up a change listener for the state dropdown to populate cities
    $('#stateDropdown').change(function() {
        var stateName = $(this).val();
        var selectedState = JSONstates.find(state => state.Name === stateName);
        $('#cityDropdown').empty().append(new Option('Select a City', ''));

        if (selectedState && selectedState.Cities.length > 0) {
            selectedState.Cities.forEach(function(city) {
                $('#cityDropdown').append(new Option(city.Name, city.Name));
            });
            $('#cityDropdown').prop('disabled', false);
        } else {
            $('#cityDropdown').prop('disabled', true);
        }
    });

});
    </script>
