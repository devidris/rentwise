@using Microsoft.Extensions.Options;
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - RentWise.Agent</title>
    <title>@ViewData["Title"] - RentWise</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/RentWise.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />
</head>
<body>
    <div class="loading hidden">
        <div class='uil-ring-css'>
            <div></div>
        </div>
    </div>
    <main class="container-fluid">
        <div class="row">
            <div class="col-12">
                @RenderBody()
            </div>
        </div>
    </main>
    @inject IOptions<RentWiseConfig> _config;
    <footer class="bg-primary p-md-5 py-4 text-white text-center main-footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-4 col-sm-12 mt-sm-4">

                    <p class="mb-3">
                        <a href="https://www.instagram.com/rentwise_app?igsh=MXJxenJqb3AyemF5bw%3D%3D&utm_source=qr" class="text-decoration-none mb-3 link-light fs-4" target="_blank">
                            <b>Follow us at</b> <i class="bi bi-instagram"></i>
                        </a>
                    </p>
                    <ul class="list-unstyled mt-4">
                        <li><a href="@_config.Value.ClientWebsiteLink/Page/About" target="_blank" class="link-light text-decoration-none fs-5">About Us</a></li>
                        <li><a href="@_config.Value.ClientWebsiteLink/Page/LegalAndPolicy" target="_blank" class="link-light text-decoration-none fs-5">Legal Terms & Privacy Policy</a></li>
                        <li><a href="@_config.Value.ClientWebsiteLink/Page/TOS" target="_blank" class="link-light text-decoration-none fs-5">Terms Of Service</a></li>
                        <li><a href="@_config.Value.ClientWebsiteLink/Page/AvoidScam" target="_blank" class="link-light text-decoration-none fs-5">Avoid Scams and Fraud</a></li>
                    </ul>
                    <div>
                        <h2>Get our app</h2>
                        <div class="d-flex gap-3 flex-wrap align-items-center justify-content-center">
                            <a href="https://apps.apple.com/ng/app/rentwise-gh/id6475678851">
                                <img src="/img/appstore.png" alt="Get app on app store" class="cursor-pointer" width="200px" />
                            </a>
                            <a href="https://play.google.com/store/apps/details?id=com.rentwisegh.rentwise&pcampaignid=web_share">
                                <img src="/img/googleplay.png" alt="Get app on google store" class="cursor-pointer" width="200px" />
                            </a>

                        </div>
                    </div>
                </div>
                <div class="col-md-4 col-sm-12  mt-sm-4">
                    <ul class="d-flex flex-column gap-2 list-unstyled">
                        <li><a href="@_config.Value.ClientWebsiteLink/Auth/Register" target="_blank" class="text-decoration-none fs-5 btn btn-outline-secondary">Register as Renter</a></li>
                        <li><a asp-controller="Home" asp-action="Index" class="link-secondary text-decoration-none fs-5 btn btn-outline-secondary">Switch to Owner</a></li>
                        <li><a href="@_config.Value.ClientWebsiteLink/Auth/Login" target="_blank" class="text-decoration-none fs-5 btn btn-outline-secondary">Login</a></li>
                    </ul>
                </div>
                <div class="col-md-4 col-sm-12  mt-sm-4">
                    <partial name="_Contact" />
                </div>
            </div>
        </div>
    </footer>
    <script src="~/lib/jquery/dist/jquery.min.js" asp-append-version="true"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js" asp-append-version="true"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
@*     <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCSk8XumgpnSn3AcgoPqQm_zZwrq8Ll6UY&libraries=places"></script> *@
    <script src="https://cdn.jsdelivr.net/npm/@@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jcarousel/0.3.6/jquery.jcarousel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.15.7/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
        <script>
            const exemptions = [{
            link: "/auth/login",
            footer:true,
            centerElement: {
               value:true,
               elementId: "loginForm",
               topOffset: 30
             }
        }, {
            link: "/auth/ForgotPassword",
            footer: true,
            centerElement: {
                value: true,
                elementId: "forgotPasswordForm",
                topOffset: 50
            }
        }, {
            link: "/auth/ResetPassword",
            footer: true,
        }, {
          link: "/auth/Register",
            footer: true,
            centerElement: {
                value: true,
                elementId: "registerForm",
                topOffset: 0
            }
        }, {
            link: "/",
            footer: true,

        }]
        exemptions.forEach(exemption => {
            const link = exemption.link;
            const currentPageLink = window.location.pathname;
            const isCurrPage = (currentPageLink.toLowerCase().includes(link.toLowerCase())) && link != "/";
            if (isCurrPage || link == "/") {
                if (exemption.footer) {
                    $(".main-footer").hide();
                }
                if (exemption.centerElement?.value) {
                    centerAnyElementVertically(exemption.centerElement.elementId, exemption.centerElement.topOffset);
                    window.addEventListener('resize', () => centerAnyElementVertically(exemption.centerElement.elementId, exemption.centerElement.topOffset));
                }
            }
        });

        function centerElementVerticallyAndHorizontally(element, raiseUpOffset) {
            const viewportHeight = window.innerHeight;
            const viewportWidth = window.innerWidth;
            const elementHeight = element.offsetHeight;
            let elementWidth = element.offsetWidth;

            // Check if the element's width is greater than 90% of the viewport width
            if (elementWidth > viewportWidth * 0.9) {
                elementWidth = viewportWidth * 0.9;
                element.style.width = `${elementWidth}px`;
            } else {
                element.style.width = `600px`;
            }

            const topOffset = (viewportHeight - elementHeight) / 2;
            const leftOffset = (viewportWidth - elementWidth) / 2;
            console.log(raiseUpOffset)
            element.style.position = 'absolute';
            element.style.top = `${topOffset - raiseUpOffset}px`;
            element.style.left = `${leftOffset}px`;
        }

        function centerAnyElementVertically(elementId, raiseUpOffset = 0) {
            const elementToCenter = document.getElementById(elementId);
            if (elementToCenter) {
                centerElementVerticallyAndHorizontally(elementToCenter, raiseUpOffset);
            } else {
                console.error(`Element with ID ${elementId} not found.`);
            }
        }
        let urlParams = new URLSearchParams(window.location.search);
        const returnUrl = decodeURIComponent(urlParams.get('ReturnUrl'));
        const returnUrlParams = new URLSearchParams(returnUrl.split('?')[1]);
        let id = returnUrlParams.get('onesignalId');
        let toastrMessage = returnUrlParams.get('message') ?? urlParams.get('message')
        if (toastrMessage) {
            toastr.success(toastrMessage)
        }
            if (id && id != "") {
                // localStorage.setItem("id", id)
                $(".loginForm").attr("action", "/Auth/Login?returnUrl=Home/Index?onesignalId=" + id);

                $(".registerForm").attr("action", "/Auth/Register?returnUrl=Home/Index?onesignalId=" + id);
            } else {
             urlParams = new URLSearchParams(window.location.search);
           id = urlParams.get('onesignalId');
            // localStorage.setItem("id", id)
            $(".loginForm").attr("action", "/Auth/Login?returnUrl=Home/Index?onesignalId=" + id);

            $(".registerForm").attr("action", "/Auth/Register?returnUrl=Home/Index?onesignalId=" + id);
        }
        if (id && id != "") {
            $.ajax({
                method: "POST",
                url: "/store/setOnesignalId?id=" + id,
                success: function (data) {
                    
                },
                error: function (error) {
                    console.log(error)
                }
            })
        }
   // Listen for click events on all links
        $('a').click(function (event) {
            event.preventDefault();
           
            const originalUrl = $(this).attr('href');
            if (originalUrl && !originalUrl.startsWith('#')) {
                showLoading()
            }
            const separator = originalUrl.indexOf('?') !== -1 ? '&' : '?';

            let newUrl = originalUrl;
            if (id && id != "") {
                newUrl = originalUrl + separator + 'onesignalId=' + id;
            }
            // Redirect to the new URL
            window.location.href = newUrl;
        });

        // Event listener for submit buttons
        $('button[type="submit"]').on('click', function (event) {
            showLoading()
        });
    </script>
     @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
